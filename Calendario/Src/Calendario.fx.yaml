Calendario As screen:
    Fill: =
    OnVisible: |
        =Select(BotonCalcularCalendario)
    Width: =Max(App.Width,App.MinScreenWidth)

    LabelMes As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Height: =77
        Size: =40
        Text: =Upper(Text(Date(var_año,var_mes,1),"mmmm"))
        Width: =372
        X: =498
        Y: =82
        ZIndex: =1

    LabelAño As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Semibold
        Height: =41
        Size: =20
        Text: =Text(Date(var_año,var_mes,1),"yyyy")
        Width: =174
        X: =1192
        Y: =100
        ZIndex: =2

    BotonCalcularCalendario As button:
        Height: =19
        OnSelect: |+
            =Set(var_primerdiames,Date(var_año,var_mes,1));
            Set(var_ultimodiames,Date(var_año,var_mes+1,0));
            Set(var_ultimodiamesanterior,var_primerdiames-1);
            Set(var_primerdiasemana,If(Weekday(var_primerdiames)-1=0,7,Weekday(var_primerdiames)-1));
            Set(var_primerdiamesanterior,Day(var_ultimodiamesanterior-var_primerdiasemana+2));
            Set(var_ultimodiasemana,If(Weekday(var_ultimodiames)-1=0,7,Weekday(var_ultimodiames-1)));
            Clear(coll_mes);
            If(var_primerdiasemana>1,
            ForAll(Sequence(Day(var_ultimodiamesanterior)-var_primerdiamesanterior+1,
            var_primerdiamesanterior),
            Collect(coll_mes,{Value: Value,delmes: false})));
            ForAll(Sequence(Day(var_ultimodiames)),
            Collect(coll_mes,{Value: Value,delmes: true}));
            ForAll(Sequence(7-var_ultimodiasemana),
            Collect(coll_mes,{Value: Value,delmes: false}));
            Clear(Coll_vacaciones);
            Collect(
                Coll_vacaciones,
                Filter(
                    Vacaciones,
                    dniEmpleado=txt_Usuario_Login.Text
            	&&
            	(Month(FechaInicio)=var_mes || Month(FechaFin)=var_mes)
                )
            )
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        Text: =""
        Visible: =false
        Width: =15
        ZIndex: =10

    IconoIzquierda As icon.ChevronLeft:
        BorderThickness: =0.5
        Color: =RGBA(241, 244, 249, 1)
        Fill: =RGBA(0, 134, 208, 1)
        Height: =551
        Icon: =Icon.ChevronLeft
        OnSelect: |-
            =Set(var_mes,var_mes-1);
            If(var_mes<1,Set(var_mes,12);Set(var_año,var_año-1));
            Select(BotonCalcularCalendario)
        Width: =152
        Y: =159
        ZIndex: =11

    IconoDerecha As icon.ChevronRight:
        BorderThickness: =0.5
        Color: =RGBA(241, 244, 249, 1)
        Fill: =RGBA(0, 134, 208, 1)
        Height: =551
        Icon: =Icon.ChevronRight
        OnSelect: |-
            =Set(var_mes,var_mes+1);
            If(var_mes>12,Set(var_mes,1);Set(var_año,var_año+1));
            Select(BotonCalcularCalendario)
        Width: =150
        X: =1216
        Y: =159
        ZIndex: =12

    GalleryCalendario As gallery.galleryVertical:
        BorderThickness: =0.5
        DelayItemLoading: =true
        Fill: =RGBA(255, 255, 255, 1)
        Height: =475
        Items: |-
            =AddColumns(
                coll_mes,
                "tabla_calendario",
                LookUp(
                    DiasFestivos,
                    Day(Fecha) = coll_mes[@Value] && Month(Fecha) = var_mes
                )
            )
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplatePadding: =0
        TemplateSize: =117
        Width: =1064
        WrapCount: =7
        X: =152
        Y: =235
        ZIndex: =14

        LabelEventoCal As label:
            Align: =Align.Center
            Fill: |
                =If(
                    ThisItem.delmes
                    ,
                    If(
                        !IsBlank(ThisItem.tabla_calendario.Motivo),
                        RGBA(255, 0, 20, 0.5),
                        If(
                            CountRows(
                                Filter(
                                    Coll_vacaciones,
                                    FechaInicio <= Date(var_año, var_mes, ThisItem.Value) &&
                                    FechaFin >= Date(var_año, var_mes, ThisItem.Value)
                                )
                            ) > 0
                            ,
                            Switch(
                                First(
                                    Filter(
                                        Coll_vacaciones,
                                        FechaInicio <= Date(var_año, var_mes, ThisItem.Value) &&
                                        FechaFin >= Date(var_año, var_mes, ThisItem.Value)
                                    )
                                ).Opciones.Value,
                                "Verano", RGBA(244, 213, 37, 0.5),
                                "Invierno", RGBA(37, 244, 229, 0.5),
                                "Baja", RGBA(37, 244, 73, 0.5),
                                "Libre Elección", RGBA(255, 50, 190, 0.4),
                                "Asuntos Propios", RGBA(112, 37, 244, 0.5),
                                RGBA(0, 0, 0, 0)  
                            )
                            ,
                            RGBA(0, 0, 0, 0)
                        )
                    )
                    ,
                    RGBA(0, 0, 0, 0)
                )
            FontWeight: =FontWeight.Semibold
            Height: =116
            OnSelect: =Select(Parent)
            Text: =If(ThisItem.delmes,ThisItem.tabla_calendario.Motivo,"")
            ZIndex: =1

        LabelDiaCal As label:
            DisabledFill: =RGBA(0, 0, 0, 0.1)
            DisplayMode: =If(!ThisItem.delmes,DisplayMode.Disabled,DisplayMode.View)
            FontWeight: =FontWeight.Bold
            Height: =116
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =15
            Text: |
                =" "&ThisItem.Value&"
                
                
                
                "
            ZIndex: =2

    FondoPopUp As rectangle:
        Fill: =RGBA(0, 0, 0, 0.25)
        Height: =768
        Visible: =puavFondo
        Width: =1366
        ZIndex: =23

    TopBar As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =35

        BotonAñadirVacaciones As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =If(
                    IsEmpty(Filter(ConfiguracionCalendario_1, Año=Text(Year(Today())) && (Today()<InicioPeticion || Today()>FinPeticion)))
                    ,
                    Set(puavvisible,true);Set(puavFondo,true);Set(puavesvalido,false)
                    ,
                    Notify(
                        "Estás fuera del periodo de petición",
                        NotificationType.Error,
                        2000
                    )  
                )
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Añadir
                Vacaciones"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            ZIndex: =13

        BotonModificarVacaciones As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =If(
                    IsEmpty(Filter(ConfiguracionCalendario_1, Año=Text(Year(Today())) && (Today()<InicioPeticion || Today()>FinPeticion)))
                    ,
                    Set(pumvvisible,true);Set(puavFondo,true);Set(puavesvalido,false)
                    ,
                    Notify(
                        "Estás fuera del periodo de petición",
                        NotificationType.Error,
                        2000
                    )  
                )
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Modificar
                Vacaciones"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            X: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            ZIndex: =15

        BotonAñadirBaja As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(puavFondo,true);Set(bajavisible,true)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Añadir
                Baja"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            X: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,304,456)
            ZIndex: =16

        BotonAñadirDLE As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |+
                =If(
                    IsEmpty(Filter(ConfiguracionCalendario_1, Año=Text(Year(Today())) && (Today()<InicioPeticion || Today()>FinPeticion)))
                    ,
                    If(
                        IsEmpty(Filter(Vacaciones, Year(FechaInicio)=Year(Today()) && Opciones.Value="Libre Elección" && dniEmpleado=txt_Usuario_Login.Text))
                        ,
                        Set(pualevisible,true);Set(puavFondo,true)
                        ,
                        Notify(
                            "Ya has pedido los días de libre elección",
                            NotificationType.Error,
                            2000
                        ) 
                    )    
                    ,
                    Notify(
                        "Estás fuera del periodo de petición",
                        NotificationType.Error,
                        2000
                    )  
                )
                
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Añadir
                Dia LE"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            X: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,456,684)
            ZIndex: =17

        BotonModificarDLE As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =If(
                    IsEmpty(
                        Filter(
                            ConfiguracionCalendario_1,
                            Año = Text(Year(Today())) && (Today() < InicioPeticion || Today() > FinPeticion)
                        )
                    ),
                    If(
                        IsEmpty(
                            Filter(
                                Vacaciones,
                                Year(FechaInicio) = Year(Today()) && Opciones.Value = "Libre Elección" && dniEmpleado = txt_Usuario_Login.Text
                            )
                        ),
                        Notify(
                            "Aún no has pedido los días de libre elección",
                            NotificationType.Error,
                            2000
                        ),
                        If(
                            IsEmpty(
                                Filter(
                                    Vacaciones,
                                    Year(FechaInicio) = Year(Today()) && Modificada = true && Opciones.Value = "Libre Elección" && dniEmpleado = txt_Usuario_Login.Text
                                )
                            ),
                            Set(
                                pumlevisible,
                                true
                            );
                            Set(
                                puavFondo,
                                true
                            ),
                            Notify(
                                "No puedes modificar los días de libre elección más de una vez",
                                NotificationType.Error,
                                2000
                            )
                        )
                    ),
                    Notify(
                        "Estás fuera del periodo de petición",
                        NotificationType.Error,
                        2000
                    )
                )
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Modificar
                Dia LE"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            X: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,608,912)
            ZIndex: =18

        BotonAñadirDAP As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =If(
                    CountRows(
                        Filter(
                            Vacaciones,
                            Opciones.Value="Asuntos Propios"
                            &&
                            Year(FechaInicio)=Year(Today())
                            &&
                            dniEmpleado=txt_Usuario_Login.Text
                        )
                    )<2
                    ,
                    Set(puavFondo,true);Set(puaapvisible,true)
                    ,
                    Notify(
                        "No puedes pedir más de 2 días de asuntos propios al año",
                        NotificationType.Error,
                        2000
                    )
                )
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Añadir
                Dia AP"
            Width: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,152,228)
            X: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,760,1140)
            ZIndex: =19

        ButtonConsultarVacaciones As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Navigate(ConsultarVacaciones)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Consultar
                Permisos"
            Visible: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,true,false)
            Width: =152
            X: =909
            ZIndex: =20

        BotonConfigurarCalendario As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Navigate(ConfiguracionCalendario)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: ="Configuración Calendario"
            Visible: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,true,false)
            Width: =152
            X: =1062
            ZIndex: =21

        BotonPortalEmpleados As button:
            BorderThickness: =1
            Fill: =RGBA(99, 139, 44, 1)
            Height: =61
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Navigate(PortalEmpleados)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: |-
                ="Portal
                Empleados"
            Visible: =If(First(Filter(Empleados,DNI=txt_Usuario_Login.Text)).EsAdmin,true,false)
            Width: =152
            X: =1214
            ZIndex: =22

    DiasSemana As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =35

        LabelLunes As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Lunes"
            Width: =151
            X: =152
            Y: =159
            ZIndex: =3

        LabelMartes As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Martes"
            Width: =151
            X: =304
            Y: =159
            ZIndex: =4

        LabelMiercoles As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Miercoles"
            Width: =151
            X: =456
            Y: =159
            ZIndex: =5

        LabelJueves As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Jueves"
            Width: =151
            X: =608
            Y: =159
            ZIndex: =6

        LabelViernes As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Viernes"
            Width: =151
            X: =760
            Y: =159
            ZIndex: =7

        LabelSabado As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Sabado"
            Width: =151
            X: =912
            Y: =159
            ZIndex: =8

        LabelDomingo As label:
            Align: =Align.Center
            BorderThickness: =1
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(56, 96, 178, 1)
            FontWeight: =FontWeight.Semibold
            Height: =76
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="Domingo"
            Width: =151
            X: =1064
            Y: =159
            ZIndex: =9

    VentanaEspera As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =37

        Cuadro_Espera As rectangle:
            Height: =600
            Visible: =enespera
            Width: =773
            X: =304
            Y: =19
            ZIndex: =91

        Label_espera As label:
            Align: =Align.Center
            Color: =RGBA(241, 244, 249, 1)
            FontWeight: =FontWeight.Bold
            Height: =309
            Size: =100
            Text: ="Espera"
            Visible: =enespera
            Width: =547
            X: =411
            Y: =159
            ZIndex: =92

    PopUpAñadirVacaciones As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =38

        Cuadro_PUAV As rectangle:
            Height: =423
            Visible: =puavvisible
            Width: =662
            X: =357
            Y: =100
            ZIndex: =24

        LabelPUAV As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =168
            Size: =28
            Text: ="Elige periodo de vacaciones"
            Visible: =puavvisible
            Width: =306
            X: =538
            Y: =141
            ZIndex: =25

        Boton_PUAV_Verano As button:
            Color: =RGBA(0, 0, 0, 1)
            Fill: =RGBA(255, 191, 0, 1)
            FontWeight: =FontWeight.Bold
            Height: =57
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =If(
                    IsEmpty(
                        Filter(
                            Vacaciones,
                            dniEmpleado = txt_Usuario_Login.Text 
                            &&
                            Opciones.Value = "Verano" 
                            && 
                            (Year(FechaInicio) = Year(Today()))
                        )
                    )
                    ,
                    Set(puavVerano,true)
                    ;
                    Set(puavvisible,false)
                    ,
                    Notify(
                        "Ya has pedido vacaciones de verano",
                        NotificationType.Error,
                        2000
                    )
                )
            Size: =20
            Text: ="Verano"
            Visible: =puavvisible
            Width: =172
            X: =455
            Y: =365
            ZIndex: =26

        Boton_PUAV_Invierno As button:
            Color: =RGBA(0, 0, 0, 1)
            Fill: =RGBA(227, 234, 243, 1)
            FontWeight: =FontWeight.Bold
            Height: =57
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =If(
                    IsEmpty(
                        Filter(
                            Vacaciones,
                            dniEmpleado = txt_Usuario_Login.Text 
                            &&
                            Opciones.Value = "Invierno" 
                            && 
                            (Year(FechaInicio) = Year(Today()))
                        )
                    )
                    ,
                    Set(puavInvierno,true)
                    ;
                    Set(puavvisible,false)
                    ,
                    Notify(
                        "Ya has pedido vacaciones de invierno",
                        NotificationType.Error,
                        2000
                    )
                )
            Size: =20
            Text: ="Invierno"
            Visible: =puavvisible
            X: =765
            Y: =365
            ZIndex: =27

        Boton_PUAV_Cancelar As button:
            Fill: =RGBA(255, 0, 0, 1)
            FontWeight: =FontWeight.Bold
            HoverFill: =ColorFade(Self.Fill, 50%)
            OnSelect: =Set(puavvisible,false);Set(puavFondo,false)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: ="X"
            Visible: =puavvisible
            Width: =40
            X: =979
            Y: =101
            ZIndex: =28

    PUAV_Verano As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =44

        Cuadro_PUAV_Verano As rectangle:
            BorderThickness: =1
            Height: =600
            Visible: =puavVerano
            Width: =774
            X: =297
            Y: =49
            ZIndex: =29

        Boton_PUAV_Aceptar_Verano As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Set(enespera,true)
                ;  
                If(
                    rb_PUAV_Verano.Selected.Value=1
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,
                            FechaFin: DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 21+var_verano3
                        }
                    )
                    ;
                    Set(var_mes,Month(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate));
                    Set(var_año,Year(Today()))
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,
                            FechaFin: DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 7+var_verano1
                        }
                        ,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,
                            FechaFin: DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 14+var_verano2
                        }
                    )
                    ;
                    Set(var_mes,Month(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate));
                    Set(var_año,Year(Today()))
                )
                ;
                Set(enespera,false);
                Set(limpiar,true);
                Set(limpiar,false);
                Set(puavVerano,false);
                Set(puavFondo,false);
                Set(varcount,1);
                Reset(rb_PUAV_Verano);
                Select(BotonCalcularCalendario)
                
                    
            Text: ="Aceptar"
            Visible: =puavVerano
            X: =811
            Y: =546
            ZIndex: =30

        Boton_PUAV_Cancelar_Verano As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: =Set(limpiar,true);Set(limpiar,false);Set(puavVerano,false);Set(puavFondo,false);Set(varcount,1);Reset(rb_PUAV_Verano)
            Text: ="Cancelar"
            Visible: =puavVerano
            X: =411
            Y: =546
            ZIndex: =31

        Label_PUAV_Bloque3_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =105
            Size: =20
            Text: ="Dia de inicio"
            Visible: =If(puavVerano && rb_PUAV_Verano.Selected.Value=1,true,false)
            Width: =314
            X: =525
            Y: =235
            ZIndex: =32

        dp_PUAV_Dia_Inicio_Verano_3 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(puavesvalido,false)
            Reset: =limpiar
            Visible: =If(puavVerano && rb_PUAV_Verano.Selected.Value=1,true,false)
            Width: =320
            X: =530
            Y: =382
            ZIndex: =33

        LabelRB_PUAV_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="¿En cuántos bloques?"
            Visible: =puavVerano
            Width: =342
            X: =392
            Y: =99
            ZIndex: =34

        rb_PUAV_Verano As radio:
            Color: =RGBA(255, 255, 255, 1)
            Default: =1
            FontWeight: =FontWeight.Bold
            Height: =109
            Items: =RadioSample
            OnChange: =Set(limpiar,true);Set(limpiar,false);Set(puavesvalido,false)
            Size: =20
            Visible: =puavVerano
            Width: =105
            X: =826
            Y: =93
            ZIndex: =35

        LabelPUAV_Bloque1_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="Inicio bloque de 1 semana"
            Visible: =If(rb_PUAV_Verano.Selected.Value=2,true,false)
            Width: =204
            X: =405
            Y: =211
            ZIndex: =36

        LabelPUAV_Bloque2_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="Inicio bloque de 2 semanas"
            Visible: =If(rb_PUAV_Verano.Selected.Value=2,true,false)
            Width: =204
            X: =411
            Y: =338
            ZIndex: =37

        dp_PUAV_Dia_Inicio_Verano_1 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(puavesvalido,false)
            Reset: =limpiar
            Visible: =If(rb_PUAV_Verano.Selected.Value=2,true,false)
            Width: =320
            X: =674
            Y: =238
            ZIndex: =38

        dp_PUAV_Dia_Inicio_Verano_2 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(puavesvalido,false)
            Reset: =limpiar
            Visible: =If(rb_PUAV_Verano.Selected.Value=2,true,false)
            Width: =320
            X: =674
            Y: =360
            ZIndex: =39

        Boton_PUAV_Comprobar_Verano As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Clear(haypuente);
                ClearCollect(collFestivos,DiasFestivos);
                If(
                    rb_PUAV_Verano.Selected.Value = 1
                    ,
                    Set(
                        var_verano3,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Set(fechapuav, dp_PUAV_Dia_Inicio_Verano_3.SelectedDate);
                    ForAll(
                        DiasFestivos,
                        If(DateDiff(ThisRecord.Fecha, fechapuav) = 0, Collect(hayfestivo, true))
                    )
                    ;
                    If(
                        Text(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "Ese dia es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                "Empleados",
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>txt_Usuario_Login.Text
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=dep_user
                                            &&
                                            (
                                                (
                                                    FechaInicio<=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                    &&
                                                    FechaFin>=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                    )
                                    ,
                                    Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "Está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "Ese dia es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                DiasFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,
                                    1-Weekday(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    DiasFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "Ese dia es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days))
                                            =
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                "Empleados",
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>txt_Usuario_Login.Text
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=dep_user
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                                    &&
                                                                    FechaFin>=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=dp_PUAV_Dia_Inicio_Verano_3.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "Está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El dia tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El dia tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El dia tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ,
                    Set(
                        bloque1,
                        false
                    )
                    ;
                    Set(
                        var_verano1,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Set(
                        var_verano2,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Clear(hayfestivo2);
                    Set(fechapuav1,dp_PUAV_Dia_Inicio_Verano_1.SelectedDate);
                    Set(fechapuav2,dp_PUAV_Dia_Inicio_Verano_2.SelectedDate);
                    ForAll(
                        collFestivos,
                        If(DateDiff(ThisRecord.Fecha, fechapuav1) = 0,Collect(hayfestivo, true));
                        If(DateDiff(ThisRecord.Fecha, fechapuav2) = 0,Collect(hayfestivo2, true))
                    )
                    ;
                    If(
                        Text(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "El dia del bloque de 1 semana es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                "Empleados",
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>txt_Usuario_Login.Text
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=dep_user
                                            &&
                                            (
                                                (
                                                    FechaInicio<=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                    &&
                                                    FechaFin>=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                    )
                                    ,
                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "El día del bloque de 1 semana es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                collFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,
                                    1-Weekday(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    collFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "El dia del bloque de 1 semana es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days))=
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                "Empleados",
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>txt_Usuario_Login.Text
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=dep_user
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                                    &&
                                                                    FechaFin>=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 1 semana tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El día del bloque de 1 semana tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El día del bloque de 1 semana tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ;
                    If(
                        bloque1
                        ,
                        If(
                            !(
                                (
                                    dp_PUAV_Dia_Inicio_Verano_2.SelectedDate <= DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    dp_PUAV_Dia_Inicio_Verano_1.SelectedDate <= DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    dp_PUAV_Dia_Inicio_Verano_2.SelectedDate <= dp_PUAV_Dia_Inicio_Verano_1.SelectedDate
                                    &&
                                    dp_PUAV_Dia_Inicio_Verano_1.SelectedDate <= DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    dp_PUAV_Dia_Inicio_Verano_2.SelectedDate <= DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    DateAdd(dp_PUAV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    <= 
                                    DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                            )
                            ,
                            If(
                                Text(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,"ddd","en-GB") = "Mon"
                                ,
                                If(
                                    First(hayfestivo2).Value=true
                                    ,
                                    Notify(
                                        "El día del bloque de 2 semanas es dia es festivo",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    If(
                                        !(
                                            (
                                                dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                <
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                            )
                                            ||
                                            (
                                                DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano1,TimeUnit.Days)
                                                >
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                            )
                                        )
                                        ,
                                        If(
                                            CountRows(
                                                Filter(
                                                    AddColumns(
                                                        Vacaciones
                                                        ,
                                                        "Empleados",
                                                        LookUp(
                                                            Empleados,
                                                            DNI = dniEmpleado
                                                        )
                                                    )
                                                    ,
                                                    dniEmpleado<>txt_Usuario_Login.Text
                                                    &&
                                                    Opciones.Value="Verano"
                                                    &&
                                                    Empleados.Departamento.Value=dep_user
                                                    &&
                                                    (
                                                        (
                                                            FechaInicio<=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                            &&
                                                            FechaFin>=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                            &&
                                                            FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio>=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                            &&
                                                            FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                    )
                                                    
                                                )
                                            )
                                            <
                                            (
                                                LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                -
                                                LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                            )
                                            ,
                                            Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                            ,
                                            Notify(
                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas está fuera del periodo de vacaciones",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                                ,
                                If(
                                    Text(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                                    Notify(
                                        "El día del bloque de 2 semanas es fin de semana",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    Clear(haypuente);
                                    Set(fechapuavpuente, DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days));
                                    ForAll(
                                        collFestivos,
                                        If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                                    );
                                    If(
                                        First(haypuente).Value=true
                                        ,
                                        Clear(lunesfiesta);
                                        Set(lunesesasemana,
                                            DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,
                                            1-Weekday(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,StartOfWeek.Monday),
                                            TimeUnit.Days)
                                        );
                                        ForAll(
                                            collFestivos,
                                            If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                        );
                                        If(
                                            First(lunesfiesta).Value=true
                                            ,
                                            If(
                                                First(hayfestivo2).Value=true
                                                ,
                                                Notify(
                                                    "El día del bloque de 2 semanas es festivo",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                                ,
                                                If(
                                                    DateDiff(lunesesasemana,DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days))=
                                                    CountIf(collFestivos,
                                                            Fecha>=lunesesasemana,
                                                            Fecha<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days)
                                                    )
                                                    ,
                                                    If(
                                                        !(
                                                            (
                                                                dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                                <
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                            )
                                                            ||
                                                            (
                                                                DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                >
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                            )
                                                        )
                                                        ,
                                                        If(
                                                            CountRows(
                                                                Filter(
                                                                    AddColumns(
                                                                        Vacaciones
                                                                        ,
                                                                        "Empleados",
                                                                        LookUp(
                                                                            Empleados,
                                                                            DNI = dniEmpleado
                                                                        )
                                                                    )
                                                                    ,
                                                                    dniEmpleado<>txt_Usuario_Login.Text
                                                                    &&
                                                                    Opciones.Value="Verano"
                                                                    &&
                                                                    Empleados.Departamento.Value=dep_user
                                                                    &&
                                                                    (
                                                                        (
                                                                            FechaInicio<=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                                            &&
                                                                            FechaFin>=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                            &&
                                                                            FechaFin>=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio>=dp_PUAV_Dia_Inicio_Verano_2.SelectedDate
                                                                            &&
                                                                            FechaFin<=DateAdd(dp_PUAV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                    )
                                                                    
                                                                )
                                                            )
                                                            <
                                                            (
                                                                LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                                -
                                                                LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                            )
                                                            ,
                                                            Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                            ,
                                                            Notify(
                                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                                NotificationType.Error,
                                                                2000
                                                            )
                                                        )
                                                        ,
                                                        Notify(
                                                            "El bloque de 2 semanas está fuera del periodo de vacaciones",
                                                            NotificationType.Error,
                                                            2000
                                                        )
                                                    )
                                                    ,
                                                    Notify(
                                                        "El día del bloque de 2 semanas tiene que ser el siguiente dia laborable después del lunes festivo",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 2 semanas tiene que ser lunes",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas tiene que ser lunes",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                            )
                            ,
                            Notify(
                                "El el bloque de 1 semana y el bloque de 2 semanas no pueden coincidir",
                                NotificationType.Error,
                                2000
                            )
                        )
                    )
                )
                
                
                
                
                
                
                
                
                
                
                
                
                    
            Text: ="Comprobar"
            Visible: =If(puavVerano && puavesvalido=false,true,false)
            X: =812
            Y: =546
            ZIndex: =40

    PUAV_Invierno As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =49

        Cuadro_PUAV_Invierno As rectangle:
            BorderThickness: =1
            Height: =375
            Visible: =puavInvierno
            Width: =654
            X: =356
            Y: =101
            ZIndex: =41

        Boton_PUAV_Cancelar_Invierno As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: =Set(limpiar,true);Set(limpiar,false);Set(puavInvierno,false);Set(puavFondo,false);Reset(rb_PUAV_Invierno)
            Text: ="Cancelar"
            Visible: =puavInvierno
            X: =433
            Y: =382
            ZIndex: =42

        Boton_PUAV_Aceptar_Invierno As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: |-
                =If(
                    IsEmpty(
                        Filter(
                            Vacaciones,
                            dniEmpleado = txt_Usuario_Login.Text && Opciones.Value = "Invierno" && (FechaInicio = LookUp(
                                ConfiguracionCalendario_1,
                                Año = Text(Year(Today()))
                            ).InicioInvierno || FechaInicio = LookUp(
                                ConfiguracionCalendario_1,
                                Año = Text(Year(Today()))
                            ).InicioInvierno2)
                        )
                    ),
                    If(
                        rb_PUAV_Invierno.Selected.Value = "Semana 1",
                        If(
                            CountRows(
                                Filter(
                                    AddColumns(
                                        Vacaciones,
                                        "Empleados",
                                        LookUp(
                                            Empleados,
                                            DNI = dniEmpleado
                                        )
                                    ),
                                    Opciones.Value = "Invierno" && FechaInicio = LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno && Empleados.Departamento.Value = dep_user
                                )
                            ) < (LookUp(
                                Departamentos_1,
                                Nombre.Value = dep_user
                            ).TotalEmpleados - LookUp(
                                Departamentos_1,
                                Nombre.Value = dep_user
                            ).MinimoEmpleados),
                            Collect(
                                Vacaciones,
                                {
                                    dniEmpleado: txt_Usuario_Login.Text,
                                    FechaInicio: LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno,
                                    FechaFin: LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).FinInvierno,
                                    Opciones: {
                                        Value: "Invierno",
                                        Label: "Invierno"
                                    },
                                    Duracion: DateDiff(
                                        LookUp(
                                            ConfiguracionCalendario_1,
                                            Año = Text(Year(Today()))
                                        ).InicioInvierno,
                                        LookUp(
                                            ConfiguracionCalendario_1,
                                            Año = Text(Year(Today()))
                                        ).FinInvierno
                                    )
                                }
                            );
                            Set(var_mes,12);
                            Set(var_año,Year(Today()));
                            Select(BotonCalcularCalendario)
                            ;
                            Set(
                                puavInvierno,
                                false
                            );
                            Set(
                                puavFondo,
                                false
                            );
                            Reset(rb_PUAV_Invierno),
                            Notify(
                                "Ya están de vacaciones el máximo de personas del departamento en esa fecha",
                                NotificationType.Error,
                                2000
                            )
                        ),
                        If(
                            CountRows(
                                Filter(
                                    Filter(
                                        AddColumns(
                                            Vacaciones,
                                            "Empleados",
                                            LookUp(
                                                Empleados,
                                                DNI = dniEmpleado
                                            )
                                        ),
                                        Opciones.Value = "Invierno"
                                    ),
                                    FechaInicio = LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno2 && Empleados.Departamento.Value = dep_user
                                )
                            ) < (LookUp(
                                Departamentos_1,
                                Nombre.Value = dep_user
                            ).TotalEmpleados - LookUp(
                                Departamentos_1,
                                Nombre.Value = dep_user
                            ).MinimoEmpleados),
                            Collect(
                                Vacaciones,
                                {
                                    dniEmpleado: txt_Usuario_Login.Text,
                                    FechaInicio: LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno2,
                                    FechaFin: LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).FinInvierno2,
                                    Opciones: {
                                        Value: "Invierno",
                                        Label: "Invierno"
                                    },
                                    Duracion: DateDiff(
                                        LookUp(
                                            ConfiguracionCalendario_1,
                                            Año = Text(Year(Today()))
                                        ).InicioInvierno2,
                                        LookUp(
                                            ConfiguracionCalendario_1,
                                            Año = Text(Year(Today()))
                                        ).FinInvierno2
                                    )
                                }
                            );
                            Set(var_mes,12);
                            Set(var_año,Year(Today()));
                            Select(BotonCalcularCalendario)
                            ;
                            Set(
                                puavInvierno,
                                false
                            );
                            Set(
                                puavFondo,
                                false
                            );
                            Reset(rb_PUAV_Invierno),
                            Notify(
                                "Ya están de vacaciones el máximo de personas del departamento en esa fecha",
                                NotificationType.Error,
                                2000
                            )
                        )
                    ),
                    Notify(
                        "Ya has pedido vacaciones de invierno previamente",
                        NotificationType.Error,
                        2000
                    )
                )
            Text: ="Aceptar"
            Visible: =puavInvierno
            X: =764
            Y: =382
            ZIndex: =43

        LabelPUAV_Invierno As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =82
            Size: =26
            Text: ="Elige semana"
            Visible: =puavInvierno
            Width: =267
            X: =557
            Y: =137
            ZIndex: =44

        rb_PUAV_Invierno As radio:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            Default: ="Semana 1"
            FontWeight: =FontWeight.Bold
            Height: =77
            Items: =["Semana 1","Semana 2"]
            Layout: =Layout.Horizontal
            LineHeight: =1.5
            PaddingLeft: =10
            PaddingRight: =10
            Size: =26
            Visible: =puavInvierno
            Width: =510
            X: =436
            Y: =240
            ZIndex: =45

    PopUp_Baja As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =55

        CuadroBaja As rectangle:
            Height: =537
            Visible: =bajavisible
            Width: =688
            X: =338
            Y: =100
            ZIndex: =46

        LabelBaja As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =132
            Size: =20
            Text: ="Indica la fecha de inicio y la duración de la baja"
            Visible: =bajavisible
            Width: =333
            X: =516
            Y: =141
            ZIndex: =47

        dp_inicio_baja As datepicker:
            Reset: =limpiar
            Visible: =bajavisible
            X: =518
            Y: =310
            ZIndex: =48

        txt_duracion_baja As text:
            Default: =
            HintText: ="Nº de días"
            Reset: =limpiar
            Visible: =bajavisible
            Width: =331
            X: =516
            Y: =400
            ZIndex: =49

        btn_cancelar_baja As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(bajavisible,false);Set(puavFondo,false);Set(limpiar,true);Set(limpiar,false)
            Text: ="Cancelar"
            Visible: =bajavisible
            X: =446
            Y: =523
            ZIndex: =50

        btn_aceptar_baja As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =Clear(hayfestivo);
                Set(fechabaja, dp_inicio_baja.SelectedDate);
                ClearCollect(collFestivos, DiasFestivos);
                ForAll(
                    collFestivos,
                    If(DateDiff(ThisRecord.Fecha, fechabaja) = 0, Collect(hayfestivo, true))
                );
                If(
                    IsBlank(txt_duracion_baja.Text)
                    ,
                    Notify(
                        "Indica la duración",
                        NotificationType.Error,
                        2000
                    )
                    ,
                    If(
                        IsNumeric(txt_duracion_baja.Text) && Round(Value(txt_duracion_baja.Text),0) = Value(txt_duracion_baja.Text)
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "Ese dia es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                Text(dp_inicio_baja.SelectedDate,"ddd","en-GB") = "Sun" || Text(dp_inicio_baja.SelectedDate,"ddd","en-GB") = "Sat"
                                ,
                                Notify(
                                    "Ese dia es fin de semana",
                                    NotificationType.Error,
                                    2000
                                )
                                ,    
                                Set(enespera,true);
                                Set(bajavisible,false);
                                Collect(
                                    Vacaciones,
                                    {
                                        dniEmpleado: txt_Usuario_Login.Text,
                                        FechaInicio: dp_inicio_baja.SelectedDate,
                                        FechaFin: DateAdd(DateValue(dp_inicio_baja.SelectedDate),txt_duracion_baja.Text-1,TimeUnit.Days),
                                        Opciones: {Value: "Baja",Label: "Baja"},
                                        Duracion: Int(txt_duracion_baja.Text)
                                    }
                                )
                                ;
                                Set(enespera,false);
                                Set(puavFondo,false);
                                Set(limpiar,true);
                                Set(limpiar,false);
                                Select(BotonCalcularCalendario)
                            )
                        )
                        ,
                        Notify(
                            "La duración debe ser un número entero",
                            NotificationType.Error,
                            2000
                        )
                    )
                )
            Text: ="Aceptar"
            Visible: =bajavisible
            X: =756
            Y: =523
            ZIndex: =51

    PopUp_AñadirLE As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =60

        CuadroPUALE As rectangle:
            Height: =588
            Visible: =pualevisible
            Width: =763
            X: =274
            Y: =31
            ZIndex: =52

        LabelPUALE As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =96
            Size: =20
            Text: ="Indica las fechas de los días de libre elección"
            Visible: =pualevisible
            Width: =345
            X: =483
            Y: =102
            ZIndex: =53

        dp_ALE2 As datepicker:
            Visible: =pualevisible
            X: =498
            Y: =247
            ZIndex: =54

        dp_ALE1 As datepicker:
            Visible: =pualevisible
            X: =498
            Y: =338
            ZIndex: =55

        btn_cancelar_PUALE As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(pualevisible,false);Set(puavFondo,false);Reset(dp_ALE1);Reset(dp_ALE2)
            Text: ="Cancelar"
            Visible: =pualevisible
            X: =405
            Y: =491
            ZIndex: =56

        btn_aceptar_PUALE As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Clear(hayfestivo2);
                Set(
                    fechapuale,
                    dp_ALE1.SelectedDate
                );
                Set(
                    fechapuale2,
                    dp_ALE2.SelectedDate
                );
                ClearCollect(
                    collFestivos,
                    DiasFestivos
                );
                ForAll(
                    collFestivos,
                    If(
                        DateDiff(
                            ThisRecord.Fecha,
                            fechapuale
                        ) = 0,
                        Collect(
                            hayfestivo,
                            true
                        )
                    );
                    If(
                        DateDiff(
                            ThisRecord.Fecha,
                            fechapuale2
                        ) = 0,
                        Collect(
                            hayfestivo2,
                            true
                        )
                    )
                );
                If(
                    First(hayfestivo).Value = true,
                    Notify(
                        "El primer día es festivo",
                        NotificationType.Error,
                        2000
                    ),
                    If(
                        First(hayfestivo2).Value = true,
                        Notify(
                            "El segundo día es festivo",
                            NotificationType.Error,
                            2000
                        ),
                        If(
                            Text(
                                dp_Fecha_PUAAP.SelectedDate,
                                "ddd",
                                "en-GB"
                            ) = "Sun" || Text(
                                dp_Fecha_PUAAP.SelectedDate,
                                "ddd",
                                "en-GB"
                            ) = "Sat",
                            Notify(
                                "El primer día es fin de semana",
                                NotificationType.Error,
                                2000
                            ),
                            If(
                                Text(
                                    dp_Fecha_PUAAP.SelectedDate,
                                    "ddd",
                                    "en-GB"
                                ) = "Sun" || Text(
                                    dp_Fecha_PUAAP.SelectedDate,
                                    "ddd",
                                    "en-GB"
                                ) = "Sat",
                                Notify(
                                    "El segundo día es fin de semana",
                                    NotificationType.Error,
                                    2000
                                )
                                ,
                                If(
                                    dp_ALE1.SelectedDate<>dp_ALE2.SelectedDate
                                    ,
                                    If(
                                        dp_ALE1.SelectedDate>Today()
                                        &&
                                        dp_ALE2.SelectedDate>Today()
                                        ,
                                        Set(
                                            enespera,
                                            true
                                        );
                                        Collect(
                                            Vacaciones,
                                            {
                                                dniEmpleado: txt_Usuario_Login.Text,
                                                FechaInicio: dp_ALE1.SelectedDate,
                                                FechaFin: dp_ALE1.SelectedDate,
                                                Opciones: {
                                                    Value: "Libre Elección",
                                                    Label: "Libre Elección"
                                                },
                                                Duracion: 1
                                            }
                                        )
                                        ;
                                        Collect(
                                            Vacaciones,
                                            {
                                                dniEmpleado: txt_Usuario_Login.Text,
                                                FechaInicio: dp_ALE2.SelectedDate,
                                                FechaFin: dp_ALE2.SelectedDate,
                                                Opciones: {
                                                    Value: "Libre Elección",
                                                    Label: "Libre Elección"
                                                },
                                                Duracion: 1
                                            }
                                        )
                                        ;
                                        Set(
                                            enespera,
                                            false
                                        )
                                        ;
                                        Set(
                                            pualevisible,
                                            false
                                        )
                                        ;
                                        Reset(dp_ALE1)
                                        ;
                                        Reset(dp_ALE2)
                                        ;
                                        Select(BotonCalcularCalendario)
                                        ;
                                        Set(
                                            puavFondo,
                                            false
                                        )
                                        ,
                                        Notify(
                                            "Los días deben ser posteriores a hoy",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                    ,
                                    Notify(
                                        "Los días deben ser distintos",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                            )
                        )
                    )
                )
            Text: ="Aceptar"
            Visible: =pualevisible
            X: =736
            Y: =491
            ZIndex: =57

    PopUp_AñadirAP As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =65

        CuadroPUAAP As rectangle:
            Height: =491
            Visible: =puaapvisible
            Width: =664
            X: =349
            Y: =103
            ZIndex: =58

        LabelPUAAP As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =98
            Size: =20
            Text: ="Indique el día de asuntos propios "
            Visible: =puaapvisible
            Width: =251
            X: =555
            Y: =158
            ZIndex: =59

        dp_Fecha_PUAAP As datepicker:
            Visible: =puaapvisible
            X: =527
            Y: =325
            ZIndex: =60

        btn_cancelar_PUAAP As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(puaapvisible,false);Set(puavFondo,false);Reset(dp_Fecha_PUAAP)
            Text: ="Cancelar"
            Visible: =puaapvisible
            X: =446
            Y: =461
            ZIndex: =61

        btn_aceptar_PUAAP As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Set(fechapuaap, dp_Fecha_PUAAP.SelectedDate);
                ClearCollect(collFestivos, DiasFestivos);
                ForAll(
                    collFestivos,
                    If(DateDiff(ThisRecord.Fecha, fechapuaap) = 0, Collect(hayfestivo, true))
                );
                If(
                    First(hayfestivo).Value=true
                    ,
                    Notify(
                        "Ese dia es festivo",
                        NotificationType.Error,
                        2000
                    )
                    ,
                    If(
                        Text(dp_Fecha_PUAAP.SelectedDate,"ddd","en-GB") = "Sun" || Text(dp_Fecha_PUAAP.SelectedDate,"ddd","en-GB") = "Sat"
                        ,
                        Notify(
                            "Ese dia es fin de semana",
                            NotificationType.Error,
                            2000
                        )
                        , 
                        If(  
                            dp_Fecha_PUAAP.SelectedDate>Today()
                            ,
                            Set(enespera,true);
                            Collect(
                                Vacaciones,
                                {
                                    dniEmpleado: txt_Usuario_Login.Text,
                                    FechaInicio: dp_Fecha_PUAAP.SelectedDate,
                                    FechaFin: dp_Fecha_PUAAP.SelectedDate,
                                    Opciones: {Value: "Asuntos Propios",Label: "Asuntos Propios"},
                                    Duracion: 1
                                }
                            );
                            Set(enespera,false);
                            Set(puaapvisible,false);
                            Set(puavFondo,false);
                            Select(BotonCalcularCalendario);
                            Reset(dp_Fecha_PUAAP)
                            ,
                            Notify(
                                "El día debe ser posterior a hoy",
                                NotificationType.Error,
                                2000
                            )
                        )
                    )
                )
            Text: ="Aceptar"
            Visible: =puaapvisible
            X: =737
            Y: =461
            ZIndex: =62

    PopUp_ModificarLE As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =71

        Cuadro_PUMLE As rectangle:
            Height: =508
            Visible: =pumlevisible
            Width: =670
            X: =348
            Y: =75
            ZIndex: =63

        Label_PUMLE As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =141
            Size: =20
            Text: ="Indica los nuevos días de libre elección"
            Visible: =pumlevisible
            Width: =321
            X: =530
            Y: =108
            ZIndex: =64

        dp_MLE1 As datepicker:
            Visible: =pumlevisible
            X: =527
            Y: =291
            ZIndex: =65

        dp_MLE2 As datepicker:
            Visible: =pumlevisible
            X: =527
            Y: =365
            ZIndex: =66

        btn_cancelar_PUMLE As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(pumlevisible,false);Set(puavFondo,false);Reset(dp_MLE1);Reset(dp_MLE2)
            Text: ="Cancelar"
            Visible: =pumlevisible
            X: =440
            Y: =483
            ZIndex: =67

        btn_aceptar_PUMLE As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |+
                =Clear(hayfestivo);
                Clear(hayfestivo2);
                Set(
                    fechapuale,
                    dp_ALE1.SelectedDate
                );
                Set(
                    fechapuale2,
                    dp_ALE2.SelectedDate
                );
                ClearCollect(
                    collFestivos,
                    DiasFestivos
                );
                ForAll(
                    collFestivos,
                    If(
                        DateDiff(
                            ThisRecord.Fecha,
                            fechapuale
                        ) = 0,
                        Collect(
                            hayfestivo,
                            true
                        )
                    );
                    If(
                        DateDiff(
                            ThisRecord.Fecha,
                            fechapuale2
                        ) = 0,
                        Collect(
                            hayfestivo2,
                            true
                        )
                    )
                );
                If(
                    First(hayfestivo).Value = true,
                    Notify(
                        "El primer día es festivo",
                        NotificationType.Error,
                        2000
                    ),
                    If(
                        First(hayfestivo2).Value = true,
                        Notify(
                            "El segundo día es festivo",
                            NotificationType.Error,
                            2000
                        ),
                        If(
                            Text(
                                dp_Fecha_PUAAP.SelectedDate,
                                "ddd",
                                "en-GB"
                            ) = "Sun" || Text(
                                dp_Fecha_PUAAP.SelectedDate,
                                "ddd",
                                "en-GB"
                            ) = "Sat",
                            Notify(
                                "El primer día es fin de semana",
                                NotificationType.Error,
                                2000
                            ),
                            If(
                                Text(
                                    dp_Fecha_PUAAP.SelectedDate,
                                    "ddd",
                                    "en-GB"
                                ) = "Sun" || Text(
                                    dp_Fecha_PUAAP.SelectedDate,
                                    "ddd",
                                    "en-GB"
                                ) = "Sat",
                                Notify(
                                    "El segundo día es fin de semana",
                                    NotificationType.Error,
                                    2000
                                )
                                ,
                                If(
                                    dp_ALE1<>dp_ALE2
                                    ,
                                    Set(
                                        enespera,
                                        true
                                    );
                                    Remove(
                                        Vacaciones,
                                        Filter(
                                            Vacaciones,
                                            dniEmpleado = txt_Usuario_Login.Text
                                            &&
                                            Year(FechaInicio)=Year(Today())
                                            &&
                                            Opciones.Value="Libre Elección"
                                        )
                                    )
                                    ;
                                    Collect(
                                        Vacaciones,
                                        {
                                            dniEmpleado: txt_Usuario_Login.Text,
                                            FechaInicio: dp_MLE1.SelectedDate,
                                            FechaFin: dp_MLE1.SelectedDate,
                                            Opciones: {
                                                Value: "Libre Elección",
                                                Label: "Libre Elección"
                                            },
                                            Duracion: 1,
                                            Modificada: true
                                        }
                                    );
                                    Collect(
                                        Vacaciones,
                                        {
                                            dniEmpleado: txt_Usuario_Login.Text,
                                            FechaInicio: dp_MLE2.SelectedDate,
                                            FechaFin: dp_MLE2.SelectedDate,
                                            Opciones: {
                                                Value: "Libre Elección",
                                                Label: "Libre Elección"
                                            },
                                            Duracion: 1,
                                            Modificada: true
                                        }
                                    );
                                    Set(
                                        enespera,
                                        false
                                    );
                                    Set(pumlevisible,false);
                                    Set(puavFondo,false);
                                    Select(BotonCalcularCalendario);
                                    Reset(dp_MLE1);
                                    Reset(dp_MLE2)
                                    ,
                                    Notify(
                                        "Los días deben ser distintos",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                            )
                        )
                    )
                )
                
            Text: ="Aceptar"
            Visible: =pumlevisible
            X: =760
            Y: =483
            ZIndex: =68

    PopUpModificarVacaciones As group:
        Height: =5
        Width: =5
        X: =20
        Y: =20
        ZIndex: =76

        Cuadro_PUMV As rectangle:
            Height: =423
            Visible: =pumvvisible
            Width: =662
            X: =353
            Y: =120
            ZIndex: =69

        Label_PUMV As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =168
            Size: =28
            Text: ="Elige periodo de vacaciones"
            Visible: =pumvvisible
            Width: =306
            X: =534
            Y: =161
            ZIndex: =70

        Boton_PUMV_Verano As button:
            Color: =RGBA(0, 0, 0, 1)
            Fill: =RGBA(255, 191, 0, 1)
            FontWeight: =FontWeight.Bold
            Height: =57
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |+
                =If(
                    !IsEmpty(
                        Filter(
                            Vacaciones,
                            dniEmpleado = txt_Usuario_Login.Text 
                            &&
                            Opciones.Value = "Verano" 
                            && 
                            (Year(FechaInicio) = Year(Today()))
                        )
                    )
                    ,
                    If(
                        IsEmpty(
                            Filter(
                                Vacaciones,
                                dniEmpleado = txt_Usuario_Login.Text 
                                &&
                                Modificada=true
                                &&
                                Opciones.Value = "Verano" 
                                && 
                                (Year(FechaInicio) = Year(Today()))
                            )
                        )
                        ,
                        Set(pumvVerano,true)
                        ;
                        Set(pumvvisible,false)
                        ,
                        Notify(
                            "No puedes modificar las vacaciones más de una vez",
                            NotificationType.Error,
                            2000
                        )
                    )
                    ,
                    Notify(
                        "Aún no has pedido vacaciones de verano",
                        NotificationType.Error,
                        2000
                    )
                )
                
            Size: =20
            Text: ="Verano"
            Visible: =pumvvisible
            Width: =172
            X: =451
            Y: =385
            ZIndex: =71

        Boton_PUMV_Invierno As button:
            Color: =RGBA(0, 0, 0, 1)
            Fill: =RGBA(227, 234, 243, 1)
            FontWeight: =FontWeight.Bold
            Height: =57
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =If(
                    !IsEmpty(
                        Filter(
                            Vacaciones,
                            dniEmpleado = txt_Usuario_Login.Text 
                            &&
                            Opciones.Value = "Invierno" 
                            && 
                            (Year(FechaInicio) = Year(Today()))
                        )
                    )
                    ,
                    If(
                        IsEmpty(
                            Filter(
                                Vacaciones,
                                dniEmpleado = txt_Usuario_Login.Text 
                                &&
                                Modificada=true
                                &&
                                Opciones.Value = "Invierno" 
                                && 
                                (Year(FechaInicio) = Year(Today()))
                            )
                        )
                        ,
                        Set(pumvInvierno,true)
                        ;
                        Set(pumvvisible,false)
                        ,
                        Notify(
                            "No puedes modificar las vacaciones más de una vez",
                            NotificationType.Error,
                            2000
                        )
                    )
                    ,
                    Notify(
                        "Aún no has pedido vacaciones de invierno",
                        NotificationType.Error,
                        2000
                    )
                )
            Size: =20
            Text: ="Invierno"
            Visible: =pumvvisible
            X: =761
            Y: =385
            ZIndex: =72

        Boton_PUMV_Cancelar As button:
            Fill: =RGBA(255, 0, 0, 1)
            FontWeight: =FontWeight.Bold
            HoverFill: =ColorFade(Self.Fill, 50%)
            OnSelect: =Set(pumvvisible,false);Set(puavFondo,false)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: ="X"
            Visible: =pumvvisible
            Width: =40
            X: =975
            Y: =121
            ZIndex: =73

    PUMV_Invierno As group:
        Height: =5
        Width: =5
        X: =120
        Y: =120
        ZIndex: =81

        Cuadro_PUAV_Invierno_1 As rectangle:
            BorderThickness: =1
            Height: =375
            Visible: =pumvInvierno
            Width: =654
            X: =361
            Y: =161
            ZIndex: =74

        Boton_PUMV_Cancelar_Invierno As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: =Set(limpiar,true);Set(limpiar,false);Set(pumvInvierno,false);Set(puavFondo,false);Set(puavesvalido,false);Set(varcount,1);Reset(rb_PUMV_Invierno)
            Text: ="Cancelar"
            Visible: =pumvInvierno
            X: =438
            Y: =442
            ZIndex: =75

        Boton_PUMV_Aceptar_Invierno As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: |-
                =Set(enespera,true);
                If(
                    rb_PUMV_Invierno.Selected.Value = "Semana 1"
                    ,
                    If(
                        CountRows(
                            Filter(
                                Filter(
                                    AddColumns(
                                        Vacaciones,
                                        "Empleados",
                                        LookUp(
                                            Empleados,
                                            DNI = dniEmpleado
                                        )
                                    ),
                                    Opciones.Value = "Invierno"
                                ),
                                FechaInicio = LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).InicioInvierno && Empleados.Departamento.Value = dep_user
                            )
                        ) < (LookUp(
                            Departamentos_1,
                            Nombre.Value = dep_user
                        ).TotalEmpleados - LookUp(
                            Departamentos_1,
                            Nombre.Value = dep_user
                        ).MinimoEmpleados)
                        ,
                        Remove(
                            Vacaciones,
                            Filter(
                                Vacaciones,
                                dniEmpleado = txt_Usuario_Login.Text && Opciones.Value = "Invierno" && (Year(FechaInicio) = Year(Today()))
                            )
                        );
                        Collect(
                            Vacaciones,
                            {
                                dniEmpleado: txt_Usuario_Login.Text,
                                FechaInicio: LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).InicioInvierno,
                                FechaFin: LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).FinInvierno,
                                Opciones: {
                                    Value: "Invierno",
                                    Label: "Invierno"
                                },
                                Duracion: DateDiff(
                                    LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno,
                                    LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).FinInvierno
                                ),
                                Modificada: true
                            }
                        )
                        ,
                        Notify(
                            "Esa semana ya está ocupada",
                            NotificationType.Error,
                            2000
                        )
                    )
                    ,
                    If(
                        CountRows(
                            Filter(
                                Filter(
                                    AddColumns(
                                        Vacaciones,
                                        "Empleados",
                                        LookUp(
                                            Empleados,
                                            DNI = dniEmpleado
                                        )
                                    ),
                                    Opciones.Value = "Invierno"
                                ),
                                FechaInicio = LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).InicioInvierno2 && Empleados.Departamento.Value = dep_user
                            )
                        ) < (LookUp(
                            Departamentos_1,
                            Nombre.Value = dep_user
                        ).TotalEmpleados - LookUp(
                            Departamentos_1,
                            Nombre.Value = dep_user
                        ).MinimoEmpleados),
                        Remove(
                            Vacaciones,
                            Filter(
                                Vacaciones,
                                dniEmpleado = txt_Usuario_Login.Text && Opciones.Value = "Invierno" && (Year(FechaInicio) = Year(Today()))
                            )
                        );
                        Collect(
                            Vacaciones,
                            {
                                dniEmpleado: txt_Usuario_Login.Text,
                                FechaInicio: LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).InicioInvierno2,
                                FechaFin: LookUp(
                                    ConfiguracionCalendario_1,
                                    Año = Text(Year(Today()))
                                ).FinInvierno2,
                                Opciones: {
                                    Value: "Invierno",
                                    Label: "Invierno"
                                },
                                Duracion: DateDiff(
                                    LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).InicioInvierno2,
                                    LookUp(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    ).FinInvierno2
                                ),
                                Modificada: true
                            }
                        )
                        ,
                        Notify(
                            "Esa semana ya está ocupada",
                            NotificationType.Error,
                            2000
                        )
                    )
                );
                Set(
                    pumvInvierno,
                    false
                );
                Set(
                    puavFondo,
                    false
                );
                Reset(rb_PUMV_Invierno);
                Set(enespera,false);
                Set(var_mes,12);
                Set(var_año,Year(Today()));
                Select(BotonCalcularCalendario)
            Text: ="Aceptar"
            Visible: =pumvInvierno
            X: =769
            Y: =442
            ZIndex: =76

        LabelPUMV_Invierno As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =82
            Size: =26
            Text: ="Elige semana"
            Visible: =pumvInvierno
            Width: =267
            X: =562
            Y: =197
            ZIndex: =77

        rb_PUMV_Invierno As radio:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            Default: ="Semana 1"
            FontWeight: =FontWeight.Bold
            Height: =77
            Items: =["Semana 1","Semana 2"]
            Layout: =Layout.Horizontal
            LineHeight: =1.5
            PaddingLeft: =10
            PaddingRight: =10
            Size: =26
            Visible: =pumvInvierno
            Width: =510
            X: =441
            Y: =300
            ZIndex: =78

    PUMV_Verano As group:
        Height: =5
        Width: =5
        X: =20
        Y: =20
        ZIndex: =93

        Cuadro_PUAV_Verano_1 As rectangle:
            BorderThickness: =1
            Height: =600
            Visible: =pumvVerano
            Width: =774
            X: =297
            Y: =69
            ZIndex: =79

        Boton_PUMV_Aceptar_Verano As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Set(enespera,true)
                ;
                Remove(
                    Vacaciones,
                    Filter(
                        Vacaciones,
                        Opciones.Value="Verano"
                        &&
                        Year(FechaInicio)=Year(Today())
                        &&
                        dniEmpleado=txt_Usuario_Login.Text
                    )
                ) 
                ;
                If(
                    rb_PUMV_Verano.Selected.Value=1
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,
                            FechaFin: DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 21+var_verano3,
                            Modificada: true
                        }
                    )
                    ;
                    Set(var_mes,Month(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate))
                    ;
                    Set(var_año,Year(Today()))
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,
                            FechaFin: DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 7+var_verano1,
                            Modificada: true
                        }
                        ,
                        {
                            dniEmpleado: txt_Usuario_Login.Text,
                            FechaInicio: dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,
                            FechaFin: DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 14+var_verano2,
                            Modificada: true
                        }
                    )
                    ;
                    Set(var_mes,Month(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate))
                    ;
                    Set(var_año,Year(Today()))
                )
                ;
                Set(enespera,false);
                Set(limpiar,true);
                Set(limpiar,false);
                Set(pumvesvalido,false);
                Set(pumvVerano,false);
                Set(puavFondo,false);
                Set(varcount,1);
                Reset(rb_PUMV_Verano);
                Select(BotonCalcularCalendario)
                
                    
                    
            Text: ="Aceptar"
            Visible: =pumvesvalido && pumvVerano
            X: =811
            Y: =566
            ZIndex: =80

        Boton_PUMV_Cancelar_Verano As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 30%)
            OnSelect: =Set(limpiar,true);Set(limpiar,false);Set(pumvVerano,false);Set(puavFondo,false);Set(varcount,1);Reset(rb_PUMV_Verano)
            Text: ="Cancelar"
            Visible: =pumvVerano
            X: =411
            Y: =566
            ZIndex: =81

        LabelBloque3PUMV_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =105
            Size: =20
            Text: ="Dia de inicio"
            Visible: =If(rb_PUMV_Verano.Selected.Value=1,true,false)&&pumvVerano
            Width: =314
            X: =525
            Y: =255
            ZIndex: =82

        dp_PUMV_Dia_Inicio_Verano_3 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(pumvesvalido,false)
            Reset: =limpiar
            Visible: =If(rb_PUMV_Verano.Selected.Value=1,true,false)&&pumvVerano
            Width: =320
            X: =530
            Y: =402
            ZIndex: =83

        LabelRB_PUMV_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="¿En cuántos bloques?"
            Visible: =pumvVerano
            Width: =342
            X: =394
            Y: =95
            ZIndex: =84

        rb_PUMV_Verano As radio:
            Color: =RGBA(255, 255, 255, 1)
            Default: =1
            FontWeight: =FontWeight.Bold
            Height: =109
            Items: =RadioSample
            OnChange: =Set(limpiar,true);Set(limpiar,false);Set(pumvesvalido,false)
            Size: =20
            Visible: =pumvVerano
            Width: =105
            X: =838
            Y: =86
            ZIndex: =85

        LabelBloque1PUMV_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="Inicio bloque de 1 semana"
            Visible: =If(rb_PUMV_Verano.Selected.Value=2,true,false)
            Width: =204
            X: =405
            Y: =231
            ZIndex: =86

        LabelBloque2PUMV_Verano As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =84
            Size: =20
            Text: ="Inicio bloque de 2 semanas"
            Visible: =If(rb_PUMV_Verano.Selected.Value=2,true,false)
            Width: =204
            X: =411
            Y: =358
            ZIndex: =87

        dp_PUMV_Dia_Inicio_Verano_1 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(pumvesvalido,false)
            Reset: =limpiar
            Visible: =If(rb_PUMV_Verano.Selected.Value=2,true,false)
            Width: =320
            X: =674
            Y: =258
            ZIndex: =88

        dp_PUMV_Dia_Inicio_Verano_2 As datepicker:
            DefaultDate: =
            InputTextPlaceholder: =
            OnChange: =Set(pumvesvalido,false)
            Reset: =limpiar
            Visible: =If(rb_PUMV_Verano.Selected.Value=2,true,false)
            Width: =320
            X: =674
            Y: =380
            ZIndex: =89

        Boton_PUMV_Comprobar_Verano As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Clear(haypuente);
                ClearCollect(collFestivos,DiasFestivos);
                If(
                    rb_PUMV_Verano.Selected.Value = 1
                    ,
                    Set(
                        var_verano3,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Set(fechapuav, dp_PUMV_Dia_Inicio_Verano_3.SelectedDate);
                    ForAll(
                        DiasFestivos,
                        If(DateDiff(ThisRecord.Fecha, fechapuav) = 0, Collect(hayfestivo, true))
                    )
                    ;
                    If(
                        Text(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "Ese dia es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                "Empleados",
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>txt_Usuario_Login.Text
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=dep_user
                                            &&
                                            (
                                                (
                                                    FechaInicio<=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                    &&
                                                    FechaFin>=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                    )
                                    ,
                                    Set(pumvesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "Está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "Ese dia es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                DiasFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,
                                    1-Weekday(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    DiasFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "Ese dia es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days))
                                            =
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                "Empleados",
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>txt_Usuario_Login.Text
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=dep_user
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                                    &&
                                                                    FechaFin>=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=dp_PUMV_Dia_Inicio_Verano_3.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_3.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(pumvesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "Está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El dia tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El dia tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El dia tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ,
                    Set(
                        bloque1,
                        false
                    )
                    ;
                    Set(
                        var_verano1,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Set(
                        var_verano2,
                        CountRows(
                            Filter(
                                collFestivos,
                                Fecha>=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                &&
                                Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,14,TimeUnit.Days)
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Clear(hayfestivo2);
                    Set(fechapuav1,dp_PUMV_Dia_Inicio_Verano_1.SelectedDate);
                    Set(fechapuav2,dp_PUMV_Dia_Inicio_Verano_2.SelectedDate);
                    ForAll(
                        collFestivos,
                        If(DateDiff(ThisRecord.Fecha, fechapuav1) = 0,Collect(hayfestivo, true));
                        If(DateDiff(ThisRecord.Fecha, fechapuav2) = 0,Collect(hayfestivo2, true))
                    )
                    ;
                    If(
                        Text(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "El dia del bloque de 1 semana es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                "Empleados",
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>txt_Usuario_Login.Text
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=dep_user
                                            &&
                                            (
                                                (
                                                    FechaInicio<=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                    &&
                                                    FechaFin>=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                    )
                                    ,
                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "El día del bloque de 1 semana es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                collFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,
                                    1-Weekday(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    collFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "El dia del bloque de 1 semana es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days))=
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                "Empleados",
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>txt_Usuario_Login.Text
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=dep_user
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                                    &&
                                                                    FechaFin>=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 1 semana tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El día del bloque de 1 semana tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El día del bloque de 1 semana tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ;
                    If(
                        bloque1,
                        If(
                            !(
                                (
                                    dp_PUMV_Dia_Inicio_Verano_2.SelectedDate <= DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    dp_PUMV_Dia_Inicio_Verano_1.SelectedDate <= DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    dp_PUMV_Dia_Inicio_Verano_2.SelectedDate <= dp_PUMV_Dia_Inicio_Verano_1.SelectedDate
                                    &&
                                    dp_PUMV_Dia_Inicio_Verano_1.SelectedDate <= DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    dp_PUMV_Dia_Inicio_Verano_2.SelectedDate <= DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    DateAdd(dp_PUMV_Dia_Inicio_Verano_1.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    <= 
                                    DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                            )
                            ,
                            If(
                                Text(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,"ddd","en-GB") = "Mon"
                                ,
                                If(
                                    First(hayfestivo2).Value=true
                                    ,
                                    Notify(
                                        "El día del bloque de 2 semanas es dia es festivo",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    If(
                                        !(
                                            (
                                                dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                <
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                            )
                                            ||
                                            (
                                                DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano1,TimeUnit.Days)
                                                >
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                            )
                                        )
                                        ,
                                        If(
                                            CountRows(
                                                Filter(
                                                    AddColumns(
                                                        Vacaciones
                                                        ,
                                                        "Empleados",
                                                        LookUp(
                                                            Empleados,
                                                            DNI = dniEmpleado
                                                        )
                                                    )
                                                    ,
                                                    dniEmpleado<>txt_Usuario_Login.Text
                                                    &&
                                                    Opciones.Value="Verano"
                                                    &&
                                                    Empleados.Departamento.Value=dep_user
                                                    &&
                                                    (
                                                        (
                                                            FechaInicio<=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                            &&
                                                            FechaFin>=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                            &&
                                                            FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio>=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                            &&
                                                            FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                    )
                                                    
                                                )
                                            )
                                            <
                                            (
                                                LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                -
                                                LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                            )
                                            ,
                                            Set(pumvesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                            ,
                                            Notify(
                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas está fuera del periodo de vacaciones",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                                ,
                                If(
                                    Text(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                                    Notify(
                                        "El día del bloque de 2 semanas es fin de semana",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    Clear(haypuente);
                                    Set(fechapuavpuente, DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days));
                                    ForAll(
                                        collFestivos,
                                        If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                                    );
                                    If(
                                        First(haypuente).Value=true
                                        ,
                                        Clear(lunesfiesta);
                                        Set(lunesesasemana,
                                            DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,
                                            1-Weekday(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,StartOfWeek.Monday),
                                            TimeUnit.Days)
                                        );
                                        ForAll(
                                            collFestivos,
                                            If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                        );
                                        If(
                                            First(lunesfiesta).Value=true
                                            ,
                                            If(
                                                First(hayfestivo2).Value=true
                                                ,
                                                Notify(
                                                    "El día del bloque de 2 semanas es festivo",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                                ,
                                                If(
                                                    DateDiff(lunesesasemana,DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days))=
                                                    CountIf(collFestivos,
                                                            Fecha>=lunesesasemana,
                                                            Fecha<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,-1,TimeUnit.Days)
                                                    )
                                                    ,
                                                    If(
                                                        !(
                                                            (
                                                                dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                                <
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).InicioVerano
                                                            )
                                                            ||
                                                            (
                                                                DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                >
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(Today()))).FinVerano
                                                            )
                                                        )
                                                        ,
                                                        If(
                                                            CountRows(
                                                                Filter(
                                                                    AddColumns(
                                                                        Vacaciones
                                                                        ,
                                                                        "Empleados",
                                                                        LookUp(
                                                                            Empleados,
                                                                            DNI = dniEmpleado
                                                                        )
                                                                    )
                                                                    ,
                                                                    dniEmpleado<>txt_Usuario_Login.Text
                                                                    &&
                                                                    Opciones.Value="Verano"
                                                                    &&
                                                                    Empleados.Departamento.Value=dep_user
                                                                    &&
                                                                    (
                                                                        (
                                                                            FechaInicio<=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                                            &&
                                                                            FechaFin>=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                            &&
                                                                            FechaFin>=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio>=dp_PUMV_Dia_Inicio_Verano_2.SelectedDate
                                                                            &&
                                                                            FechaFin<=DateAdd(dp_PUMV_Dia_Inicio_Verano_2.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                    )
                                                                    
                                                                )
                                                            )
                                                            <
                                                            (
                                                                LookUp(Departamentos_1,Nombre.Value=dep_user).TotalEmpleados
                                                                -
                                                                LookUp(Departamentos_1,Nombre.Value=dep_user).MinimoEmpleados
                                                            )
                                                            ,
                                                            Set(pumvesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                            ,
                                                            Notify(
                                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                                NotificationType.Error,
                                                                2000
                                                            )
                                                        )
                                                        ,
                                                        Notify(
                                                            "El bloque de 2 semanas está fuera del periodo de vacaciones",
                                                            NotificationType.Error,
                                                            2000
                                                        )
                                                    )
                                                    ,
                                                    Notify(
                                                        "El día del bloque de 2 semanas tiene que ser el siguiente dia laborable después del lunes festivo",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 2 semanas tiene que ser lunes",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas tiene que ser lunes",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                            )
                            ,
                            Notify(
                                "El el bloque de 1 semana y el bloque de 2 semanas no pueden coincidir",
                                NotificationType.Error,
                                2000
                            )
                        )
                    )
                )
                
                
                
                
                
                
                
                
                
                
                
                
                    
            Text: ="Comprobar"
            Visible: =!pumvesvalido && pumvVerano
            X: =812
            Y: =566
            ZIndex: =90

    Leyenda As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =105

        RectangleLeyendaFestivo As rectangle:
            Fill: =RGBA(255, 0, 0, 0.5)
            Height: =58
            Width: =228
            Y: =710
            ZIndex: =93

        RectangleLeyendaBaja As rectangle:
            Fill: |+
                =RGBA(37, 244, 73, 0.5)
                
                
            Height: =58
            Width: =228
            X: =684
            Y: =710
            ZIndex: =94

        RectangleLeyendaInvierno As rectangle:
            Fill: |+
                =RGBA(37, 244, 229, 0.5)
                
            Height: =58
            Width: =228
            X: =456
            Y: =710
            ZIndex: =95

        RectangleLeyendaVerano As rectangle:
            Fill: =RGBA(244, 213, 37, 0.5)
            Height: =58
            Width: =228
            X: =228
            Y: =710
            ZIndex: =96

        RectangleLeyendaAP As rectangle:
            Fill: |+
                =RGBA(112, 37, 244, 0.5)
                
            Height: =58
            Width: =228
            X: =1140
            Y: =710
            ZIndex: =97

        LabelLeyendaVerano As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Vacaciones de verano"
            Width: =228
            X: =228
            Y: =711
            ZIndex: =98

        LabelLeyendaInvierno As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Vacaciones de invierno"
            Width: =228
            X: =456
            Y: =711
            ZIndex: =99

        LabelLeyendaFestivo As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Día festivo"
            Width: =228
            Y: =711
            ZIndex: =100

        LabelLeyendaAP As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Asuntos Propios"
            Width: =226
            X: =1140
            Y: =711
            ZIndex: =101

        LabelLeyendaBaja As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Baja"
            Width: =228
            X: =684
            Y: =710
            ZIndex: =102

        RectangleLeyendaLE As rectangle:
            Fill: =RGBA(255, 50, 190, 0.4)
            Height: =57
            Width: =228
            X: =912
            Y: =711
            ZIndex: =103

        LabelLeyendaLE As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =57
            Size: =16
            Text: ="Libre Elección"
            Width: =228
            X: =910
            Y: =710
            ZIndex: =104

