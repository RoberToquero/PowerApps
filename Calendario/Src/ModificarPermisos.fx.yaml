ModificarPermisos As screen:

    RectangleConsultarVacaciones_1 As rectangle:
        Fill: =RGBA(255, 191, 0, 1)
        Height: =128
        Width: =1366
        ZIndex: =1

    LabelTituloConsultarVacaciones_1 As label:
        Align: =Align.Center
        Color: =RGBA(255, 255, 255, 1)
        FontWeight: =FontWeight.Bold
        Height: =128
        Size: =30
        Text: ="Modificar permisos"
        Width: =634
        X: =366
        ZIndex: =2

    IconVolverConsultarVacaciones_1 As icon.Undo:
        Color: =RGBA(255, 255, 255, 1)
        Height: =90
        Icon: =Icon.Undo
        OnSelect: =Back()
        Width: =94
        X: =136
        Y: =19
        ZIndex: =3

    Label3 As label:
        FontWeight: =FontWeight.Semibold
        Height: =52
        Size: =18
        Text: |-
            ="Empleado: "&GalleryConsultarVacaciones.Selected.NombreEmpleado&" "&GalleryConsultarVacaciones.Selected.ApellidosEmpleado
        Width: =442
        X: =68
        Y: =204
        ZIndex: =4

    Label4 As label:
        FontWeight: =FontWeight.Semibold
        Height: =66
        Size: =16
        Text: |-
            ="Tipo: "&GalleryConsultarVacaciones.Selected.Opciones.Value
        Width: =269
        X: =97
        Y: =288
        ZIndex: =5

    ContainerLibreEleccion As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Height: =640
        Visible: |-
            =If(
                GalleryConsultarVacaciones.Selected.Opciones.Value="Libre Elección",
                true,
                false
            )
        Width: =822
        X: =544
        Y: =128
        ZIndex: =7

        DatePicker4 As datepicker:
            DefaultDate: =GalleryConsultarVacaciones.Selected.FechaInicio
            X: =247
            Y: =268
            ZIndex: =1

        Label5 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =91
            Size: =20
            Text: ="Selecciona la nueva fecha de Libre Elección"
            Width: =359
            X: =232
            Y: =88
            ZIndex: =2

        Button7 As button:
            Fill: =RGBA(54, 176, 75, 1)
            Height: =39
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Set(
                    fechapuale,
                    DatePicker4.SelectedDate
                );
                ClearCollect(
                    collFestivos,
                    DiasFestivos
                );
                ForAll(
                    collFestivos,
                    If(
                        DateDiff(
                            ThisRecord.Fecha,
                            fechapuale
                        ) = 0,
                        Collect(
                            hayfestivo,
                            true
                        )
                    )
                );
                If(
                    First(hayfestivo).Value = true,
                    Notify(
                        "El día es festivo",
                        NotificationType.Error,
                        2000
                    ),
                    If(
                        Text(
                            DatePicker4.SelectedDate,
                            "ddd",
                            "en-GB"
                        ) = "Sun" || Text(
                            DatePicker4.SelectedDate,
                            "ddd",
                            "en-GB"
                        ) = "Sat",
                        Notify(
                            "El día es fin de semana",
                            NotificationType.Error,
                            2000
                        ),
                        If(
                            CountRows(
                                Filter(
                                    Vacaciones,
                                    dniEmpleado = GalleryConsultarVacaciones.Selected.dniEmpleado && FechaInicio = DatePicker4.SelectedDate
                                )
                            ) > 0,
                            Notify(
                                "El día coincide con otro permiso",
                                NotificationType.Error,
                                2000
                            ),
                            Patch(
                                Vacaciones,
                                First(
                                    Filter(
                                        Vacaciones,
                                        dniEmpleado = GalleryConsultarVacaciones.Selected.dniEmpleado && FechaInicio = GalleryConsultarVacaciones.Selected.FechaInicio && Opciones.Value = "Libre Elección"
                                    )
                                ),
                                {
                                    FechaInicio: DatePicker4.SelectedDate,
                                    FechaFin: DatePicker4.SelectedDate
                                }
                            )
                        )
                    )
                )
            Text: ="Confirmar"
            Width: =155
            X: =334
            Y: =464
            ZIndex: =3

    ContainerInvierno As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Height: =638
        Visible: |-
            =If(
                GalleryConsultarVacaciones.Selected.Opciones.Value="Invierno",
                true,
                false
            )
        Width: =822
        X: =544
        Y: =130
        ZIndex: =8

        Radio1 As radio:
            Default: ="Semana 1"
            Height: =72
            Items: =["Semana 1","Semana 2"]
            Layout: =Layout.Horizontal
            Size: =16
            Width: =380
            X: =216
            Y: =248
            ZIndex: =1

        Label7 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =112
            Size: =20
            Text: ="Indique la nueva semana "
            Width: =254
            X: =279
            Y: =57
            ZIndex: =2

        Button8 As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =Set(
                    enespera,
                    true
                );
                If(
                    CountRows(
                        Filter(
                            Filter(
                                AddColumns(
                                    Vacaciones,
                                    Empleados,
                                    LookUp(
                                        Empleados,
                                        DNI = dniEmpleado
                                    )
                                ),
                                Opciones.Value = "Invierno"
                            ),
                            FechaInicio = LookUp(
                                ConfiguracionCalendario_1,
                                Año = Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))
                            ).InicioInvierno && Empleados.Departamento.Value = GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                        )
                    ) < (LookUp(
                        Departamentos_1,
                        Nombre.Value = GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                    ).TotalEmpleados - LookUp(
                        Departamentos_1,
                        Nombre.Value = GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                    ).MinimoEmpleados),
                    Patch(
                        Vacaciones,
                        First(
                            Filter(
                                Vacaciones,
                                dniEmpleado = GalleryConsultarVacaciones.Selected.dniEmpleado && Opciones.Value = GalleryConsultarVacaciones.Selected.Opciones.Value && FechaInicio = GalleryConsultarVacaciones.Selected.FechaInicio
                            )
                        ),
                        {
                            FechaInicio: If(
                                Radio1.Selected.Value = "Semana 1",
                                First(
                                    Filter(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    )
                                ).InicioInvierno,
                                First(
                                    Filter(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    )
                                ).InicioInvierno2
                            ),
                            FechaFin: If(
                                Radio1.Selected.Value = "Semana 1",
                                First(
                                    Filter(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    )
                                ).FinInvierno,
                                First(
                                    Filter(
                                        ConfiguracionCalendario_1,
                                        Año = Text(Year(Today()))
                                    )
                                ).FinInvierno2
                            )
                        }
                    ),
                    Notify(
                        "Esa semana ya está ocupada",
                        NotificationType.Error,
                        2000
                    )
                );
                Reset(Radio1);
                Set(
                    enespera,
                    false
                );
            Text: ="Confirmar"
            X: =326
            Y: =470
            ZIndex: =3

    ContainerVerano As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Height: =640
        Visible: |-
            =If(
                GalleryConsultarVacaciones.Selected.Opciones.Value="Verano",
                true,
                false
            )
        Width: =822
        X: =544
        Y: =128
        ZIndex: =9

        Label8 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =100
            Size: =20
            Text: ="Selecciona en cuantos bloques"
            Width: =274
            X: =156
            Y: =44
            ZIndex: =1

        Radio2 As radio:
            Default: ="1"
            Items: =RadioSample
            OnChange: =Set(puavesvalido,false)
            X: =508
            Y: =44
            ZIndex: =2

        Group2 As group:
            Height: =5
            Width: =5
            X: =40
            Y: =40
            ZIndex: =8

            DatePicker6 As datepicker:
                Visible: |-
                    =If(
                        Radio2.Selected.Value=2,
                        true,
                        false
                    )
                X: =430
                Y: =384
                ZIndex: =4

            DatePicker7 As datepicker:
                Visible: |-
                    =If(
                        Radio2.Selected.Value=2,
                        true,
                        false
                    )
                X: =430
                Y: =244
                ZIndex: =5

            Label9 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Semibold
                Height: =64
                Size: =16
                Text: ="Inicio bloque de 1 semana"
                Visible: |-
                    =If(
                        Radio2.Selected.Value=2,
                        true,
                        false
                    )
                Width: =154
                X: =186
                Y: =223
                ZIndex: =6

            Label10 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Semibold
                Height: =57
                Size: =16
                Text: ="Inicio bloque de 2 semanas"
                Visible: |-
                    =If(
                        Radio2.Selected.Value=2,
                        true,
                        false
                    )
                Width: =153
                X: =186
                Y: =367
                ZIndex: =7

        Button9 As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |
                =Remove(
                    Vacaciones,
                    Filter(
                        Vacaciones,
                        Opciones.Value="Verano"
                        &&
                        Year(FechaInicio)=Year(GalleryConsultarVacaciones.Selected.FechaInicio)
                        &&
                        dniEmpleado=GalleryConsultarVacaciones.Selected.dniEmpleado
                    )
                ) 
                ;
                If(
                    Radio2.Selected.Value=1
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: GalleryConsultarVacaciones.Selected.dniEmpleado,
                            FechaInicio: DatePicker5.SelectedDate,
                            FechaFin: DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 21+var_verano3,
                            Modificada: true
                        }
                    )
                    ,
                    Collect(
                        Vacaciones,
                        {
                            dniEmpleado: GalleryConsultarVacaciones.Selected.dniEmpleado,
                            FechaInicio: DatePicker7.SelectedDate,
                            FechaFin: DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 7+var_verano1,
                            Modificada: true
                        }
                        ,
                        {
                            dniEmpleado: GalleryConsultarVacaciones.Selected.dniEmpleado,
                            FechaInicio: DatePicker6.SelectedDate,
                            FechaFin: DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days),
                            Opciones: {Value: "Verano", Label: "Verano"},
                            Duracion: 14+var_verano2,
                            Modificada: true
                        }
                    )
                )
                ;
                Set(puavesvalido,false);
                Reset(Radio2);
                Reset(DatePicker5);
                Reset(DatePicker6);
                Reset(DatePicker7);
                Navigate(ConsultarVacaciones)
            Text: ="Aceptar"
            Visible: =puavesvalido
            X: =340
            Y: =527
            ZIndex: =9

        Button3 As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =Clear(hayfestivo);
                Clear(haypuente);
                ClearCollect(collFestivos,DiasFestivos);
                If(
                    Radio2.Selected.Value = 1
                    ,
                    Set(
                        var_verano3,
                        CountRows(
                            Filter(
                                collFestivos,
                                If(
                                    Text(Fecha,"ddd","en-GB") = "Sun"
                                    ,
                                    DateAdd(Fecha,1,TimeUnit.Days)>=DatePicker5.SelectedDate
                                    &&
                                    DateAdd(Fecha,1,TimeUnit.Days)<=DateAdd(DatePicker5.SelectedDate,20,TimeUnit.Days)
                                    ,
                                    If(
                                        Text(Fecha,"ddd","en-GB") <> "Sat",
                                        Fecha>=DatePicker5.SelectedDate
                                        &&
                                        Fecha<=DateAdd(DatePicker5.SelectedDate,20,TimeUnit.Days)
                                    )
                                    
                                )
                                
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Set(fechapuav, DatePicker5.SelectedDate);
                    ForAll(
                        DiasFestivos,
                        If(
                            Text(ThisRecord.Fecha,"ddd","en-GB")="Sun"
                            ,
                            If(DateDiff(DateAdd(ThisRecord.Fecha,1,TimeUnit.Days), fechapuav) = 0, Collect(hayfestivo, true))
                            ,
                            If(DateDiff(ThisRecord.Fecha, fechapuav) = 0, Collect(hayfestivo, true))
                        )
                        
                    )
                    ;
                    If(
                        Text(DatePicker5.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "Ese dia es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        DatePicker5.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                Empleados,
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                            &&
                                            (
                                                (
                                                    FechaInicio<=DatePicker5.SelectedDate
                                                    &&
                                                    FechaFin>=DatePicker5.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=DatePicker5.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                    )
                                    ,
                                    Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "Está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(DatePicker5.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "Ese dia es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(DatePicker5.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                DiasFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(DatePicker5.SelectedDate,
                                    1-Weekday(DatePicker5.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    DiasFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "Ese dia es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(DatePicker5.SelectedDate,-1,TimeUnit.Days))
                                            =
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(DatePicker5.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        DatePicker5.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                Empleados,
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=DatePicker5.SelectedDate
                                                                    &&
                                                                    FechaFin>=DatePicker5.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=DatePicker5.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(DatePicker5.SelectedDate,20+var_verano3,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "Este periodo de vacaciones entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "Está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El dia tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El dia tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El dia tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ,
                    Set(
                        bloque1,
                        false
                    )
                    ;
                    Set(
                        var_verano1,
                        CountRows(
                            Filter(
                                collFestivos,
                                If(
                                    Text(Fecha,"ddd","en-GB") = "Sun"
                                    ,
                                    DateAdd(Fecha,1,TimeUnit.Days)>=DatePicker7.SelectedDate
                                    &&
                                    DateAdd(Fecha,1,TimeUnit.Days)<=DateAdd(DatePicker7.SelectedDate,6,TimeUnit.Days)
                                    ,
                                    If(
                                        Text(Fecha,"ddd","en-GB") <> "Sat",
                                        Fecha>=DatePicker7.SelectedDate
                                        &&
                                        Fecha<=DateAdd(DatePicker7.SelectedDate,6,TimeUnit.Days)
                                    )   
                                ) 
                            )
                        )
                    )
                    ;
                    Set(
                        var_verano2,
                        CountRows(
                            Filter(
                                collFestivos,
                                If(
                                    Text(Fecha,"ddd","en-GB") = "Sun"
                                    ,
                                    DateAdd(Fecha,1,TimeUnit.Days)>=DatePicker6.SelectedDate
                                    &&
                                    DateAdd(Fecha,1,TimeUnit.Days)<=DateAdd(DatePicker6.SelectedDate,13,TimeUnit.Days)
                                    ,
                                    If(
                                        Text(Fecha,"ddd","en-GB") <> "Sat",
                                        Fecha>=DatePicker6.SelectedDate
                                        &&
                                        Fecha<=DateAdd(DatePicker6.SelectedDate,13,TimeUnit.Days)
                                    )
                                )
                            )
                        )
                    )
                    ;
                    Clear(hayfestivo);
                    Clear(hayfestivo2);
                    Set(fechapuav1,DatePicker7.SelectedDate);
                    Set(fechapuav2,DatePicker6.SelectedDate);
                    ForAll(
                        collFestivos,
                        If(
                            Text(ThisRecord.Fecha,"ddd","en-GB")="Sun"
                            ,
                            If(DateDiff(DateAdd(ThisRecord.Fecha,1,TimeUnit.Days), fechapuav1) = 0, Collect(hayfestivo, true));
                            If(DateDiff(DateAdd(ThisRecord.Fecha,1,TimeUnit.Days), fechapuav2) = 0,Collect(hayfestivo2, true))
                            ,
                            If(DateDiff(ThisRecord.Fecha, fechapuav1) = 0, Collect(hayfestivo, true));
                            If(DateDiff(ThisRecord.Fecha, fechapuav2) = 0,Collect(hayfestivo2, true))
                        )  
                    )
                    ;
                    If(
                        Text(DatePicker7.SelectedDate,"ddd","en-GB") = "Mon"
                        ,
                        If(
                            First(hayfestivo).Value=true
                            ,
                            Notify(
                                "El dia del bloque de 1 semana es festivo",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            If(
                                !(
                                    (
                                        DatePicker7.SelectedDate
                                        <
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                    )
                                    ||
                                    (
                                        DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                        >
                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                    )
                                )
                                ,
                                If(
                                    CountRows(
                                        Filter(
                                            AddColumns(
                                                Vacaciones
                                                ,
                                                Empleados,
                                                LookUp(
                                                    Empleados,
                                                    DNI = dniEmpleado
                                                )
                                            )
                                            ,
                                            dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                            &&
                                            Opciones.Value="Verano"
                                            &&
                                            Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                            &&
                                            (
                                                (
                                                    FechaInicio<=DatePicker7.SelectedDate
                                                    &&
                                                    FechaFin>=DatePicker7.SelectedDate
                                                )
                                                ||
                                                (
                                                    FechaInicio<=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                    &&
                                                    FechaFin>=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                                ||
                                                (
                                                    FechaInicio>=DatePicker7.SelectedDate
                                                    &&
                                                    FechaFin<=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                )
                                            )
                                            
                                        )
                                    )
                                    <
                                    (
                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                        -
                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                    )
                                    ,
                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                    ,
                                    Notify(
                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                        ,
                        If(
                            Text(DatePicker7.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                            Notify(
                                "El día del bloque de 1 semana es fin de semana",
                                NotificationType.Error,
                                2000
                            )
                            ,
                            Clear(haypuente);
                            Set(fechapuavpuente, DateAdd(DatePicker7.SelectedDate,-1,TimeUnit.Days));
                            ForAll(
                                collFestivos,
                                If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                            );
                            If(
                                First(haypuente).Value=true
                                ,
                                Clear(lunesfiesta);
                                Set(lunesesasemana,
                                    DateAdd(DatePicker7.SelectedDate,
                                    1-Weekday(DatePicker7.SelectedDate,StartOfWeek.Monday),
                                    TimeUnit.Days)
                                );
                                ForAll(
                                    collFestivos,
                                    If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                );
                                If(
                                    First(lunesfiesta).Value=true
                                    ,
                                    If(
                                        First(hayfestivo).Value=true
                                        ,
                                        Notify(
                                            "El dia del bloque de 1 semana es festivo",
                                            NotificationType.Error,
                                            2000
                                        )
                                        ,
                                        If(
                                            DateDiff(lunesesasemana,DateAdd(DatePicker7.SelectedDate,-1,TimeUnit.Days))=
                                            CountIf(collFestivos,
                                                    Fecha>=lunesesasemana,
                                                    Fecha<=DateAdd(DatePicker7.SelectedDate,-1,TimeUnit.Days)
                                            )
                                            ,
                                            If(
                                                !(
                                                    (
                                                        DatePicker7.SelectedDate
                                                        <
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                                    )
                                                    ||
                                                    (
                                                        DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                        >
                                                        LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                                    )
                                                )
                                                ,
                                                If(
                                                    CountRows(
                                                        Filter(
                                                            AddColumns(
                                                                Vacaciones
                                                                ,
                                                                Empleados,
                                                                LookUp(
                                                                    Empleados,
                                                                    DNI = dniEmpleado
                                                                )
                                                            )
                                                            ,
                                                            dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                                            &&
                                                            Opciones.Value="Verano"
                                                            &&
                                                            Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                                            &&
                                                            (
                                                                (
                                                                    FechaInicio<=DatePicker7.SelectedDate
                                                                    &&
                                                                    FechaFin>=DatePicker7.SelectedDate
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio<=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                    &&
                                                                    FechaFin>=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                                ||
                                                                (
                                                                    FechaInicio>=DatePicker7.SelectedDate
                                                                    &&
                                                                    FechaFin<=DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                                                )
                                                            )
                                                            
                                                        )
                                                    )
                                                    <
                                                    (
                                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                                        -
                                                        LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                                    )
                                                    ,
                                                    Set(bloque1,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                    ,
                                                    Notify(
                                                        "El bloque de 1 semana entra en conflicto con demasiados compañeros de departamento",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                                ,
                                                Notify(
                                                    "El bloque de 1 semana está fuera del periodo de vacaciones",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 1 semana tiene que ser el siguiente dia laborable después del lunes festivo",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                    )
                                    ,
                                    Notify(
                                        "El día del bloque de 1 semana tiene que ser lunes",
                                        NotificationType.Error,
                                        2000
                                    )
                                )
                                ,
                                Notify(
                                    "El día del bloque de 1 semana tiene que ser lunes",
                                    NotificationType.Error,
                                    2000
                                )
                            )
                        )
                    )
                    ;
                    If(
                        bloque1
                        ,
                        If(
                            !(
                                (
                                    DatePicker6.SelectedDate <= DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    DatePicker7.SelectedDate <= DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    DatePicker6.SelectedDate <= DatePicker7.SelectedDate
                                    &&
                                    DatePicker7.SelectedDate <= DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                                ||
                                (
                                    DatePicker6.SelectedDate <= DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    &&
                                    DateAdd(DatePicker7.SelectedDate,6+var_verano1,TimeUnit.Days)
                                    <= 
                                    DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                )
                            )
                            ,
                            If(
                                Text(DatePicker6.SelectedDate,"ddd","en-GB") = "Mon"
                                ,
                                If(
                                    First(hayfestivo2).Value=true
                                    ,
                                    Notify(
                                        "El día del bloque de 2 semanas es dia es festivo",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    If(
                                        !(
                                            (
                                                DatePicker6.SelectedDate
                                                <
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                            )
                                            ||
                                            (
                                                DateAdd(DatePicker6.SelectedDate,13+var_verano1,TimeUnit.Days)
                                                >
                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                            )
                                        )
                                        ,
                                        If(
                                            CountRows(
                                                Filter(
                                                    AddColumns(
                                                        Vacaciones
                                                        ,
                                                        Empleados,
                                                        LookUp(
                                                            Empleados,
                                                            DNI = dniEmpleado
                                                        )
                                                    )
                                                    ,
                                                    dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                                    &&
                                                    Opciones.Value="Verano"
                                                    &&
                                                    Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                                    &&
                                                    (
                                                        (
                                                            FechaInicio<=DatePicker6.SelectedDate
                                                            &&
                                                            FechaFin>=DatePicker6.SelectedDate
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio<=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                            &&
                                                            FechaFin>=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                        ||
                                                        (
                                                            FechaInicio>=DatePicker6.SelectedDate
                                                            &&
                                                            FechaFin<=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                        )
                                                    )
                                                    
                                                )
                                            )
                                            <
                                            (
                                                LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                                -
                                                LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                            )
                                            ,
                                            Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                            ,
                                            Notify(
                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas está fuera del periodo de vacaciones",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                                ,
                                If(
                                    Text(DatePicker6.SelectedDate,"ddd","en-GB") = "Sun"||"Sat",
                                    Notify(
                                        "El día del bloque de 2 semanas es fin de semana",
                                        NotificationType.Error,
                                        2000
                                    )
                                    ,
                                    Clear(haypuente);
                                    Set(fechapuavpuente, DateAdd(DatePicker6.SelectedDate,-1,TimeUnit.Days));
                                    ForAll(
                                        collFestivos,
                                        If(DateDiff(ThisRecord.Fecha, fechapuavpuente) = 0, Collect(haypuente, true))
                                    );
                                    If(
                                        First(haypuente).Value=true
                                        ,
                                        Clear(lunesfiesta);
                                        Set(lunesesasemana,
                                            DateAdd(DatePicker6.SelectedDate,
                                            1-Weekday(DatePicker6.SelectedDate,StartOfWeek.Monday),
                                            TimeUnit.Days)
                                        );
                                        ForAll(
                                            collFestivos,
                                            If(DateDiff(ThisRecord.Fecha, lunesesasemana) = 0, Collect(lunesfiesta, true))
                                        );
                                        If(
                                            First(lunesfiesta).Value=true
                                            ,
                                            If(
                                                First(hayfestivo2).Value=true
                                                ,
                                                Notify(
                                                    "El día del bloque de 2 semanas es festivo",
                                                    NotificationType.Error,
                                                    2000
                                                )
                                                ,
                                                If(
                                                    DateDiff(lunesesasemana,DateAdd(DatePicker6.SelectedDate,-1,TimeUnit.Days))=
                                                    CountIf(collFestivos,
                                                            Fecha>=lunesesasemana,
                                                            Fecha<=DateAdd(DatePicker6.SelectedDate,-1,TimeUnit.Days)
                                                    )
                                                    ,
                                                    If(
                                                        !(
                                                            (
                                                                DatePicker6.SelectedDate
                                                                <
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).InicioVerano
                                                            )
                                                            ||
                                                            (
                                                                DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                >
                                                                LookUp(ConfiguracionCalendario_1,Año=Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))).FinVerano
                                                            )
                                                        )
                                                        ,
                                                        If(
                                                            CountRows(
                                                                Filter(
                                                                    AddColumns(
                                                                        Vacaciones
                                                                        ,
                                                                        Empleados,
                                                                        LookUp(
                                                                            Empleados,
                                                                            DNI = dniEmpleado
                                                                        )
                                                                    )
                                                                    ,
                                                                    dniEmpleado<>GalleryConsultarVacaciones.Selected.dniEmpleado
                                                                    &&
                                                                    Opciones.Value="Verano"
                                                                    &&
                                                                    Empleados.Departamento.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado
                                                                    &&
                                                                    (
                                                                        (
                                                                            FechaInicio<=DatePicker6.SelectedDate
                                                                            &&
                                                                            FechaFin>=DatePicker6.SelectedDate
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio<=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                            &&
                                                                            FechaFin>=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                        ||
                                                                        (
                                                                            FechaInicio>=DatePicker6.SelectedDate
                                                                            &&
                                                                            FechaFin<=DateAdd(DatePicker6.SelectedDate,13+var_verano2,TimeUnit.Days)
                                                                        )
                                                                    )
                                                                    
                                                                )
                                                            )
                                                            <
                                                            (
                                                                LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).TotalEmpleados
                                                                -
                                                                LookUp(Departamentos_1,Nombre.Value=GalleryConsultarVacaciones.Selected.DepartamentoEmpleado).MinimoEmpleados
                                                            )
                                                            ,
                                                            Set(puavesvalido,true)//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                                            ,
                                                            Notify(
                                                                "El bloque de 2 semanas entra en conflicto con demasiados compañeros de departamento",
                                                                NotificationType.Error,
                                                                2000
                                                            )
                                                        )
                                                        ,
                                                        Notify(
                                                            "El bloque de 2 semanas está fuera del periodo de vacaciones",
                                                            NotificationType.Error,
                                                            2000
                                                        )
                                                    )
                                                    ,
                                                    Notify(
                                                        "El día del bloque de 2 semanas tiene que ser el siguiente dia laborable después del lunes festivo",
                                                        NotificationType.Error,
                                                        2000
                                                    )
                                                )
                                            )
                                            ,
                                            Notify(
                                                "El día del bloque de 2 semanas tiene que ser lunes",
                                                NotificationType.Error,
                                                2000
                                            )
                                        )
                                        ,
                                        Notify(
                                            "El día del bloque de 2 semanas tiene que ser lunes",
                                            NotificationType.Error,
                                            2000
                                        )
                                    )
                                )
                            )
                            ,
                            Notify(
                                "El el bloque de 1 semana y el bloque de 2 semanas no pueden coincidir",
                                NotificationType.Error,
                                2000
                            )
                        )
                    )
                )
                
                
                
                
                
                
                
                
                
                
                
                
                    
            Text: ="Comprobar"
            Visible: =!puavesvalido
            X: =340
            Y: =527
            ZIndex: =10

        Group3 As group:
            Height: =5
            Width: =5
            X: =40
            Y: =40
            ZIndex: =10

            DatePicker5 As datepicker:
                Visible: |-
                    =If(
                        Radio2.Selected.Value=1,
                        true,
                        false
                    )
                X: =256
                Y: =384
                ZIndex: =3

            Label13 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Semibold
                Height: =50
                Size: =18
                Text: ="Fecha Inicio"
                Visible: |-
                    =If(
                        Radio2.Selected.Value=1,
                        true,
                        false
                    )
                Width: =178
                X: =331
                Y: =284
                ZIndex: =8

    Button10 As button:
        Fill: =RGBA(255, 0, 0, 1)
        HoverFill: =ColorFade(Self.Fill, 20%)
        OnSelect: =Set(popUpEliminarModificarPermisos,true)
        Text: ="Eliminar"
        X: =189
        Y: =557
        ZIndex: =10

    Group4 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =17

        Rectangle8 As rectangle:
            Fill: =RGBA(0, 0, 0, 0.2)
            Height: =768
            Visible: =popUpEliminarModificarPermisos
            Width: =1366
            ZIndex: =11

        Rectangle9 As rectangle:
            Height: =316
            Visible: =popUpEliminarModificarPermisos
            Width: =565
            X: =400
            Y: =256
            ZIndex: =12

        Label14 As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Semibold
            Height: =123
            Size: =18
            Text: |-
                =If(
                    GalleryConsultarVacaciones.Selected.Opciones.Value="Verano",
                    "¿Seguro que quieres eliminar los registros de las vacaciones de verano de "
                     &Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))
                     &" del empleado: "
                     &GalleryConsultarVacaciones.Selected.NombreEmpleado
                     &" "
                     &GalleryConsultarVacaciones.Selected.ApellidosEmpleado
                     &"?"
                    ,
                    If(
                        GalleryConsultarVacaciones.Selected.Opciones.Value="Invierno",
                        "¿Seguro que quieres eliminar los registros de las vacaciones de invierno de "
                         &Text(Year(GalleryConsultarVacaciones.Selected.FechaInicio))
                         &" del empleado: "
                         &GalleryConsultarVacaciones.Selected.NombreEmpleado
                         &" "
                         &GalleryConsultarVacaciones.Selected.ApellidosEmpleado
                         &"?"
                        ,
                        "¿Seguro que quieres eliminar el registro de Día de Libre Elección con fecha: "
                         &GalleryConsultarVacaciones.Selected.FechaInicio
                         &" del empleado: "
                         &GalleryConsultarVacaciones.Selected.NombreEmpleado
                         &" "
                         &GalleryConsultarVacaciones.Selected.ApellidosEmpleado
                         &"?"
                    )
                )
            Visible: =popUpEliminarModificarPermisos
            Width: =417
            X: =490
            Y: =309
            ZIndex: =13

        Icon7 As icon.Information:
            Color: =RGBA(255, 0, 0, 1)
            Fill: =RGBA(255, 255, 0, 1)
            Height: =49
            Icon: =Icon.Information
            Visible: =popUpEliminarModificarPermisos
            Width: =54
            X: =416
            Y: =272
            ZIndex: =14

        Button11 As button:
            Fill: =RGBA(255, 0, 0, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: =Set(popUpEliminarModificarPermisos,false)
            Text: ="Cancelar"
            Visible: =popUpEliminarModificarPermisos
            X: =490
            Y: =486
            ZIndex: =15

        Button12 As button:
            Fill: =RGBA(54, 176, 75, 1)
            HoverFill: =ColorFade(Self.Fill, 20%)
            OnSelect: |-
                =If(
                    GalleryConsultarVacaciones.Selected.Opciones.Value<>"Verano"
                    ,
                    Remove(
                        Vacaciones,
                        First(
                            Filter(
                                Vacaciones,
                                dniEmpleado=GalleryConsultarVacaciones.Selected.dniEmpleado
                                &&
                                FechaInicio=GalleryConsultarVacaciones.Selected.FechaInicio
                                &&
                                Opciones.Value=GalleryConsultarVacaciones.Selected.Opciones.Value
                            )
                        )
                    )
                    ,
                    Remove(
                        Vacaciones,
                        Filter(
                            Vacaciones,
                            dniEmpleado=GalleryConsultarVacaciones.Selected.dniEmpleado
                            &&
                            Opciones.Value="Verano"
                        )
                    )
                )
                ;
                Set(popUpEliminarModificarPermisos,false);
                Navigate(ConsultarVacaciones)
            Text: ="Aceptar"
            Visible: =popUpEliminarModificarPermisos
            X: =715
            Y: =486
            ZIndex: =16

